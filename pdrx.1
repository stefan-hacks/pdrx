.\" pdrx.1 - man page for pdrx
.\" Portable Dynamic Reproducible gnu/linuX - reproducible Linux system setup
.\" Use: groff -man -Tutf8 pdrx.1 | less
.TH PDRX 1 "2025\-02\-15" "pdrx 1.4.7" "User Commands"
.SH NAME
pdrx \- Portable Dynamic Reproducible gnu/linuX: reproducible Linux system setup with declarative package config
.SH SYNOPSIS
.B pdrx
[\fIOPTIONS\fR] \fICOMMAND\fR [\fIARGS\fR...]
.PP
.B pdrx
\fB\-h\fR | \fB\-\-help\fR
.PP
.B pdrx
\fB\-v\fR | \fB\-\-version\fR
.PP
.B pdrx
\fB\-\-install\fR
.SH DESCRIPTION
.B pdrx
(Portable Dynamic Reproducible gnu/linuX) is a pure Bash tool for fully reproducible Linux system setups. It has no Nix or other external dependency and works on Debian, Ubuntu, Fedora, Arch, openSUSE, and other major distributions.
.PP
You install and remove packages imperatively (e.g. \fBpdrx install vim\fR). pdrx records each package together with the \fIpackage manager\fR used (apt, flatpak, cargo, etc.) in a declarative config file. When you run \fBpdrx apply\fR on another machine, it installs the same packages via the same package managers, giving you a reproducible environment.
.PP
Supported package managers: \fBapt\fR, \fBdnf\fR, \fByum\fR, \fBpacman\fR, \fBzypper\fR, \fBbrew\fR, \fBflatpak\fR, \fBsnap\fR, and \fBcargo\fR. pdrx auto-detects which of these are available on the system.
.PP
Additional features:
.IP \(bu 2
Desktop environment export/restore (GNOME, KDE, XFCE, i3, Sway, Hyprland).
.IP \(bu 2
Dotfile tracking (e.g. \fI~/.bashrc\fR, \fI~/.config/nvim/init.vim\fR).
.IP \(bu 2
Timestamped backups (generations) and rollback.
.IP \(bu 2
Export/import of config as a tarball for sharing or migration.
.SH OPTIONS
Global options must appear before the command. All options are optional unless stated otherwise.
.TP
\fB\-h\fR, \fB\-\-help\fR
Print a short help and exit.
.TP
\fB\-v\fR, \fB\-\-version\fR
Print the program version and exit.
.TP
\fB\-q\fR, \fB\-\-quiet\fR
Reduce output. May be used with any command.
.TP
\fB\-d\fR, \fB\-\-debug\fR
Enable verbose/debug output.
.TP
\fB\-y\fR, \fB\-\-yes\fR
Answer yes to all confirmation prompts (e.g. restore, destroy, clean). Use with care.
.TP
\fB\-n\fR, \fB\-\-dry\-run\fR
Show what would be done without making changes. Supported for \fBapply\fR, \fBrestore\fR, and similar.
.TP
\fB\-c\fR \fIDIR\fR, \fB\-\-config\fR \fIDIR\fR
Use \fIDIR\fR as the pdrx home (config, backups, state). Default is \fI$HOME/.pdrx\fR.
.TP
\fB\-\-install\fR
Install the pdrx script to \fI~/.local/bin/pdrx\fR and add that directory to PATH in \fI~/.bashrc\fR and \fI~/.zshrc\fR if missing. Then run \fBpdrx init\fR to initialize.
.SH COMMANDS
Most commands require pdrx to be initialized (\fBpdrx init\fR). \fBsearch\fR and \fB\-\-help\fR/\fB\-\-version\fR/\fB\-\-install\fR do not.
.SS init
Initialize pdrx. Creates the config directory structure under \fBPDRX_HOME\fR (default \fI~/.pdrx\fR), the declarative packages file, and state files. Also exports the current desktop state if supported.
.PP
.RS
.B pdrx init
.RE
.SS status
Show current status: config path, backups path, OS and desktop IDs, detected package managers, number of packages in the declarative config, and number of backups.
.PP
.RS
.B pdrx status
.RE
.SS install
Install one or more packages and record them in the declarative config. If multiple package managers are available, pdrx prompts you to choose one per package (or use \fB\-\-pm\fR to force a PM). The chosen PM is stored so that \fBpdrx apply\fR uses the same PM on another machine.
.TP
\fBpdrx install\fR \fIpkg\fR [\fIpkg\fR...]
Install \fIpkg\fR(s); choose PM interactively if there is more than one.
.TP
\fBpdrx install \-\-pm\fR \fIPM\fR \fIpkg\fR [\fIpkg\fR...]
Install using the given package manager only. \fIPM\fR must be one of: apt, dnf, yum, pacman, zypper, brew, flatpak, snap, cargo.
.PP
.RS
.B pdrx install vim git
.br
.B pdrx install \-\-pm flatpak org.gnome.GIMP
.br
.B pdrx install \-\-pm cargo ripgrep bat
.RE
.SS remove
Remove one or more packages and update the declarative config. pdrx looks up the package manager that was used when the package was added and uses that same PM to uninstall. If the package is not in the config, it is searched for across all available PMs and removed if found.
.PP
.RS
.B pdrx remove vim
.br
.B pdrx remove package1 package2
.RE
.SS list
List all packages in the declarative config (one per line in \fIpm:package\fR form).
.PP
.RS
.B pdrx list
.RE
.SS search
Search for packages across one or more package managers. Results are shown in a table with \fBName\fR, \fBVersion\fR, \fBPublisher\fR, \fBNotes\fR, and \fBSummary\fR where available. Version information is included for all supported PMs.
.TP
\fBpdrx search\fR \fITERM\fR
Search for \fITERM\fR. If multiple PMs exist, you are prompted: press Enter to search \fBall\fR, or enter space-separated numbers (e.g. \fB1 2\fR) to search only those PMs (1 = first listed, 2 = second, etc.).
.TP
\fBpdrx search\fR \fITERM\fR \fIN\fR [\fIN\fR...]
Search only in the PM(s) with the given index numbers (e.g. \fB1 4\fR for first and fourth). No prompt.
.TP
\fBpdrx search \-\-pm\fR \fIPM\fR \fITERM\fR
Search only in the given package manager \fIPM\fR.
.PP
.RS
.B pdrx search ripgrep
.br
.B pdrx search vim 1 4
.br
.B pdrx search \-\-pm apt vim
.RE
.SS sync
Capture the current system state into the declarative config. Scans all detected package managers for installed packages, merges with any existing \fIpackages.conf\fR entries, and overwrites \fIpackages.conf\fR with the combined set (each line: \fIpackage_manager:package_name\fR). Also exports the current desktop state. Use after manual installs/removals to bring the declarative config in line with the system.
.PP
.RS
.B pdrx sync
.RE
.SS apply
Apply the declarative config: install every package listed in \fIpackages.conf\fR using its \fIrecorded\fR package manager. Skips packages already installed. Deploys tracked dotfiles and can restore desktop state. This is the main command for reproducing a setup on a new machine.
.PP
.RS
.B pdrx apply
.br
.B pdrx \-n apply
(in dry-run mode)
.RE
.SS track
Track a dotfile: copy it into the pdrx config and optionally symlink it back so edits go to the tracked copy. \fIFILE\fR can be an absolute path or a path relative to \fI$HOME\fR.
.PP
.RS
.B pdrx track ~/.bashrc
.br
.B pdrx track .config/nvim/init.vim
.RE
.SS untrack
Stop tracking a dotfile and remove its copy from the config. Does not remove the file from your home directory.
.PP
.RS
.B pdrx untrack ~/.bashrc
.RE
.SS backup
Create a timestamped backup (generation) of the current config, desktop export, dotfiles, and tracked-dotfiles list. Optional \fILABEL\fR is appended to the directory name (e.g. \fI20250215_120000_manual\fR or \fI20250215_120000_before-upgrade\fR).
.PP
.RS
.B pdrx backup
.br
.B pdrx backup before-upgrade
.RE
.SS restore
Restore the pdrx config from a backup directory. \fIPATH\fR must be the full path to a backup directory (e.g. under \fI~/.pdrx/backups/\fR). Prompts for confirmation unless \fB\-y\fR is used.
.PP
.RS
.B pdrx restore ~/.pdrx/backups/20250215_120000_manual
.RE
.SS generations
List all backup generations (oldest to newest) with reference numbers 1, 2, ... and the path to each backup directory. The last line indicates \fBcurrent\fR (the active config, not a backup). These numbers are used by \fBclean\fR and \fBrollback\fR.
.PP
.RS
.B pdrx generations
.RE
.SS clean
Remove backup generations to free space. Without \fIARG\fR, prints the same numbered list as \fBgenerations\fR and usage hints.
.TP
\fBpdrx clean\fR
List generations and show clean usage.
.TP
\fBpdrx clean all\fR
Remove \fIall\fR backup directories. Confirmation required unless \fB\-y\fR.
.TP
\fBpdrx clean current\fR
Remove only the \fInewest\fR backup (the one that \fBrollback 1\fR would restore to).
.TP
\fBpdrx clean\fR \fIRef\fR
Remove the backup with the given reference number (e.g. \fB2\fR).
.TP
\fBpdrx clean\fR \fIR1\-R2\fR
Remove backups with reference numbers from \fIR1\fR to \fIR2\fR inclusive (e.g. \fBpdrx clean 3\-10\fR or \fBpdrx clean 10\-3\fR). Order does not matter.
.PP
.RS
.B pdrx clean
.br
.B pdrx clean 2\-4
.br
.B pdrx \-y clean all
.RE
.SS rollback
Restore from the N-th most recent backup (N defaults to 1). \fBrollback 1\fR restores the newest backup, \fBrollback 2\fR the second-newest, and so on. Same as \fBpdrx restore\fR \fIpath\fR to that backup.
.PP
.RS
.B pdrx rollback
.br
.B pdrx rollback 2
.RE
.SS sync-desktop
Export the current desktop/DE state (GNOME, KDE, XFCE, i3, Sway, Hyprland, etc.) into the pdrx config. Used automatically by \fBsync\fR.
.PP
.RS
.B pdrx sync-desktop
.RE
.SS sync-desktop \-\-restore
Restore the previously exported desktop state. Used automatically by \fBapply\fR.
.PP
.RS
.B pdrx sync-desktop \-\-restore
.RE
.SS update
Update all detected package manager indexes/caches (e.g. \fBapt-get update\fR, \fBpacman -Sy\fR). Does not upgrade installed packages.
.PP
.RS
.B pdrx update
.RE
.SS upgrade
Upgrade all installed packages using each detected package manager (e.g. \fBapt-get upgrade\fR, \fBdnf upgrade\fR, \fBpacman -Su\fR, \fBbrew upgrade\fR, \fBflatpak update\fR, \fBsnap refresh\fR). For \fBcargo\fR, requires the \fIcargo-update\fR crate (\fBcargo install cargo-update\fR); if not installed, a warning is shown and cargo is skipped.
.PP
.RS
.B pdrx upgrade
.RE
.SS export
Export the pdrx config (and state) as a gzipped tarball. If \fIFILE\fR is given, the tarball is written to \fIFILE\fR; otherwise it is written to stdout.
.PP
.RS
.B pdrx export my-config.tar.gz
.br
.B pdrx export > backup.tar.gz
.RE
.SS import
Import a config tarball (created with \fBpdrx export\fR) into the current pdrx home. Extracts into \fBPDRX_HOME\fR (config/state). Overwrites existing config; use with care.
.PP
.RS
.B pdrx import my-config.tar.gz
.RE
.SS destroy
Return the system to the way it was before using pdrx. All configs and rc files are put back safely: for each tracked dotfile that is currently a symlink, the symlink is removed and replaced with a real file (content copied from the pdrx config), so files like \fI~/.bashrc\fR and \fI~/.config/nvim/init.vim\fR are restored to their correct locations with no symlinks left. Then the pdrx home directory (config, backups, state) is deleted, the \fI~/.local/bin/pdrx\fR binary is removed, and the PATH line added to \fI~/.bashrc\fR and \fI~/.zshrc\fR is removed. \fBDoes not\fR uninstall packages that were installed with pdrx. Prompts for confirmation unless \fB\-y\fR.
.PP
.RS
.B pdrx destroy
.br
.B pdrx \-y destroy
.RE
.SH DECLARATIVE FORMAT
The file \fIpackages.conf\fR (under \fBPDRX_HOME/config\fR) is the declarative package list. Each non-empty, non-comment line has the form:
.PP
.RS
\fIpackage_manager\fR\fB:\fR\fIpackage_name\fR
.RE
.PP
Examples:
.PP
.RS
.nf
apt:vim
apt:git
flatpak:org.gnome.GIMP
cargo:ripgrep
.fi
.RE
.PP
Adding a package with \fBpdrx install\fR (or \fBinstall \-\-pm\fR) appends the corresponding line. \fBpdrx remove\fR removes the line. \fBpdrx apply\fR reads each line and runs the appropriate PM to install the package. Storing the PM per package ensures the same source and versioning behavior when restoring on another machine.
.SH FILES
.TP
\fI$HOME/.pdrx\fR (or \fBPDRX_HOME\fR)
Top-level pdrx directory.
.TP
\fI$PDRX_HOME/config/packages.conf\fR
Declarative package list (one \fIpm:package\fR per line).
.TP
\fI$PDRX_HOME/config/dotfiles/\fR
Tracked dotfiles (copies).
.TP
\fI$PDRX_HOME/config/desktop-export/\fR
Exported desktop/DE state.
.TP
\fI$PDRX_HOME/backups/\fR
Timestamped backup directories (generations).
.TP
\fI$PDRX_HOME/state/\fR
State files (e.g. initialized, version, tracked-dotfiles list).
.SH ENVIRONMENT
.TP
\fBPDRX_HOME\fR
Override the pdrx home directory (default: \fI$HOME/.pdrx\fR). Can also be set via \fB\-c\fR \fIDIR\fR.
.SH EXIT STATUS
.TP
0
Success.
.TP
1
Error (invalid usage, missing config, or command failure).
.SH VERSION
1.4.7
.SH HOMEPAGE
https://github.com/stefan-hacks/pdrx
.PP
Please report bugs and feature requests to the issue tracker. Please do your best to provide a reproducible test case for bugs. This should include the steps to reproduce, the pdrx command, the actual output and the expected output. Please also include the output of running the same pdrx command with the \fB\-d\fR (\fB\-\-debug\fR) flag.
.PP
If you have questions that don't obviously fall into the "bug" or "feature request" category, then they are welcome in the Discussions section of the repository: https://github.com/stefan-hacks/pdrx/discussions.
.SH EXAMPLES
.PP
First-time setup and capture current system:
.PP
.RS
.nf
\fBpdrx init\fR
\fBpdrx sync\fR
\fBpdrx backup initial\fR
.fi
.RE
.PP
Install packages (interactive PM choice or forced PM):
.PP
.RS
.nf
\fBpdrx install vim git htop\fR
\fBpdrx install \-\-pm flatpak org.gnome.GIMP\fR
\fBpdrx install \-\-pm cargo ripgrep bat\fR
.fi
.RE
.PP
Search in all PMs (press Enter when prompted) or only in apt and snap:
.PP
.RS
.nf
\fBpdrx search ripgrep\fR
\fBpdrx search vim 1 4\fR
.fi
.RE
.PP
Before/after a big change:
.PP
.RS
.nf
\fBpdrx backup before-upgrade\fR
\fB# ... do upgrade ...\fR
\fBpdrx sync\fR
\fBpdrx backup after-upgrade\fR
.fi
.RE
.PP
List and clean old backups (remove refs 2 through 4):
.PP
.RS
.nf
\fBpdrx generations\fR
\fBpdrx clean 2\-4\fR
.fi
.RE
.PP
Restore from the most recent backup:
.PP
.RS
\fBpdrx rollback 1\fR
.RE
.PP
Upgrade all packages (refresh indexes first, then upgrade):
.PP
.RS
.nf
\fBpdrx update\fR
\fBpdrx upgrade\fR
.fi
.RE
.PP
Reproduce setup on a new machine:
.PP
.RS
.nf
\fBpdrx init\fR
\fBpdrx import my-config.tar.gz\fR
\fBpdrx apply\fR
\fBpdrx sync-desktop \-\-restore\fR
.fi
.RE
.PP
Revert to pre\-pdrx state (restore dotfiles to real files, remove symlinks, remove pdrx):
.PP
.RS
\fBpdrx destroy\fR
.RE
.SH SEE ALSO
\fBapt\fR(8), \fBdnf\fR(8), \fBpacman\fR(8), \fBflatpak\fR(1), \fBsnap\fR(8), \fBcargo\fR(1), \fBbrew\fR(1)
.PP
Project and full documentation: see the \fIREADME.md\fR in the pdrx source tree.
.SH AUTHORS
stefan-hacks <stefanmrobertson@gmail.com>
